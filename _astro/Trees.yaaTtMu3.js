import{f as et,c as at,g as M,t as y,b as J,i as S,a as C,e as x,k as B,F as W,s as g,r as it,d as gt,S as mt}from"./web.BZqZJ-hq.js";import{B as Y}from"./Button.BWvfOJ-p.js";import{c as zt}from"./store.BSlkbLxL.js";const xt=(e,t)=>{const a=document.createElement("a");a.setAttribute("href",`data:text/plain;charset=utf-8,${encodeURIComponent(t)}`),a.setAttribute("download",e),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)},nt=Math.min(window.innerWidth,1200),st=Math.max(window.innerHeight-80,600),V=()=>({startPos:{x:.5,y:1},startDir:{x:0,y:-1},sizeStart:16,sizeEnd:1,sizeDecreaseSpeed:.025,sizeJitter:.08,rotateAmount:.04,moveJitter:.3,upDir:{x:0,y:-1},skyAttractionStart:.015,skyAttractionEnd:.01,splitStartSize:13,splitChanceStart:.01,splitChanceEnd:.05,splitCooldownStart:60,splitCooldownEnd:20,splitChildMinAngle:Math.PI/4,splitChildMaxAngle:Math.PI/3,splitParentMinAngle:0,splitParentMaxAngle:Math.PI/4,splitMinSizeFactor:.5,splitMaxSizeFactor:1,leafStartSize:10,leafChanceStart:0,leafChanceEnd:.25,leafMinSize:2,leafMaxSize:8,leafRange:40,leafAlternateChance:.1}),K=[{name:"default",generate:V},{name:"evergreen",generate:()=>({startPos:{x:.5,y:1},startDir:{x:0,y:-1},sizeStart:16,sizeEnd:1,sizeDecreaseSpeed:.025,sizeJitter:.04,rotateAmount:.002,moveJitter:.4,upDir:{x:0,y:-1},skyAttractionStart:.001,skyAttractionEnd:0,splitStartSize:14,splitChanceStart:.08,splitChanceEnd:.12,splitCooldownStart:5,splitCooldownEnd:2,splitChildMinAngle:Math.PI/3.3,splitChildMaxAngle:Math.PI/3,splitParentMinAngle:0,splitParentMaxAngle:0,splitMinSizeFactor:.4,splitMaxSizeFactor:.5,leafStartSize:12,leafChanceStart:.1,leafChanceEnd:.5,leafMinSize:1,leafMaxSize:4,leafRange:20,leafAlternateChance:.1})},{name:"bushy",generate:()=>({startPos:{x:.5,y:1},startDir:{x:0,y:-1},sizeStart:16,sizeEnd:1,sizeDecreaseSpeed:.025,sizeJitter:.08,rotateAmount:.1,moveJitter:.2,upDir:{x:0,y:-1},skyAttractionStart:.02,skyAttractionEnd:.01,splitStartSize:12,splitChanceStart:.02,splitChanceEnd:.1,splitCooldownStart:30,splitCooldownEnd:25,splitChildMinAngle:Math.PI/4,splitChildMaxAngle:Math.PI/2,splitParentMinAngle:0,splitParentMaxAngle:Math.PI/3,splitMinSizeFactor:.5,splitMaxSizeFactor:1,leafStartSize:8,leafChanceStart:.1,leafChanceEnd:.5,leafMinSize:2,leafMaxSize:9,leafRange:45,leafAlternateChance:.1})},{name:"gnarly",generate:()=>({startPos:{x:.5,y:1},startDir:{x:0,y:-1},sizeStart:16,sizeEnd:1,sizeDecreaseSpeed:.025,sizeJitter:.08,rotateAmount:.35,moveJitter:1,upDir:{x:0,y:-1},skyAttractionStart:.04,skyAttractionEnd:.02,splitStartSize:15,splitChanceStart:.02,splitChanceEnd:.04,splitCooldownStart:80,splitCooldownEnd:50,splitChildMinAngle:Math.PI/4,splitChildMaxAngle:Math.PI/2,splitParentMinAngle:0,splitParentMaxAngle:Math.PI/8,splitMinSizeFactor:.5,splitMaxSizeFactor:1,leafStartSize:6,leafChanceStart:0,leafChanceEnd:.1,leafMinSize:2,leafMaxSize:6,leafRange:20,leafAlternateChance:.1})},{name:"dead",generate:()=>({startPos:{x:.5,y:1},startDir:{x:0,y:-1},sizeStart:16,sizeEnd:1,sizeDecreaseSpeed:.025,sizeJitter:.08,rotateAmount:.08,moveJitter:.8,upDir:{x:0,y:-1},skyAttractionStart:.06,skyAttractionEnd:.04,splitStartSize:15,splitChanceStart:.012,splitChanceEnd:.02,splitCooldownStart:60,splitCooldownEnd:30,splitChildMinAngle:Math.PI/4,splitChildMaxAngle:Math.PI/2,splitParentMinAngle:0,splitParentMaxAngle:Math.PI/8,splitMinSizeFactor:.5,splitMaxSizeFactor:1,leafStartSize:8,leafChanceStart:0,leafChanceEnd:.001,leafMinSize:2,leafMaxSize:8,leafRange:12,leafAlternateChance:.1})},{name:"smooth",generate:()=>({startPos:{x:.5,y:1},startDir:{x:0,y:-1},sizeStart:16,sizeEnd:1,sizeDecreaseSpeed:.025,sizeJitter:0,rotateAmount:0,moveJitter:0,upDir:{x:0,y:-1},skyAttractionStart:.05,skyAttractionEnd:.05,splitStartSize:15,splitChanceStart:.025,splitChanceEnd:.03,splitCooldownStart:60,splitCooldownEnd:30,splitChildMinAngle:Math.PI/4,splitChildMaxAngle:Math.PI/2,splitParentMinAngle:0,splitParentMaxAngle:0,splitMinSizeFactor:.75,splitMaxSizeFactor:.75,leafStartSize:8,leafChanceStart:0,leafChanceEnd:.3,leafMinSize:2,leafMaxSize:8,leafRange:30,leafAlternateChance:.1})},{name:"crazy",generate:()=>({startPos:{x:.5,y:1},startDir:{x:0,y:-1},sizeStart:16,sizeEnd:1,sizeDecreaseSpeed:.02,sizeJitter:.1,rotateAmount:.5,moveJitter:.5,upDir:{x:0,y:-1},skyAttractionStart:.1,skyAttractionEnd:.2,splitStartSize:15,splitChanceStart:.05,splitChanceEnd:.08,splitCooldownStart:60,splitCooldownEnd:45,splitChildMinAngle:Math.PI/4,splitChildMaxAngle:Math.PI,splitParentMinAngle:0,splitParentMaxAngle:Math.PI/2,splitMinSizeFactor:.6,splitMaxSizeFactor:1.1,leafStartSize:7,leafChanceStart:0,leafChanceEnd:.06,leafMinSize:2,leafMaxSize:10,leafRange:30,leafAlternateChance:.05})},{name:"cactus",generate:()=>({startPos:{x:.5,y:1},startDir:{x:0,y:-1},sizeStart:20,sizeEnd:12,sizeDecreaseSpeed:.015,sizeJitter:.05,rotateAmount:0,moveJitter:.3,upDir:{x:0,y:-1},skyAttractionStart:.15,skyAttractionEnd:.2,splitStartSize:19.9,splitChanceStart:.06,splitChanceEnd:.04,splitCooldownStart:120,splitCooldownEnd:100,splitChildMinAngle:Math.PI/2,splitChildMaxAngle:Math.PI/2,splitParentMinAngle:0,splitParentMaxAngle:0,splitMinSizeFactor:.75,splitMaxSizeFactor:.9,leafStartSize:12.1,leafChanceStart:1,leafChanceEnd:1,leafMinSize:6,leafMaxSize:12,leafRange:16,leafAlternateChance:.1})},{name:"zero-g",generate:()=>({startPos:{x:.5,y:.5},startDir:{x:0,y:-1},sizeStart:16,sizeEnd:1,sizeDecreaseSpeed:.028,sizeJitter:.1,rotateAmount:.5,moveJitter:.3,upDir:{x:0,y:-1},skyAttractionStart:0,skyAttractionEnd:0,splitStartSize:15,splitChanceStart:.01,splitChanceEnd:.1,splitCooldownStart:60,splitCooldownEnd:40,splitChildMinAngle:Math.PI/2,splitChildMaxAngle:Math.PI,splitParentMinAngle:0,splitParentMaxAngle:Math.PI/2,splitMinSizeFactor:.5,splitMaxSizeFactor:1,leafStartSize:0,leafChanceStart:0,leafChanceEnd:0,leafMinSize:0,leafMaxSize:0,leafRange:0,leafAlternateChance:0})},{name:"shrub",generate:()=>({startPos:{x:.5,y:1},startDir:{x:0,y:-1},sizeStart:3,sizeEnd:1,sizeDecreaseSpeed:.005,sizeJitter:.02,rotateAmount:.06,moveJitter:.25,upDir:{x:0,y:-1},skyAttractionStart:.05,skyAttractionEnd:.04,splitStartSize:10,splitChanceStart:.05,splitChanceEnd:.1,splitCooldownStart:55,splitCooldownEnd:25,splitChildMinAngle:Math.PI/3,splitChildMaxAngle:Math.PI/2,splitParentMinAngle:0,splitParentMaxAngle:Math.PI/4,splitMinSizeFactor:.8,splitMaxSizeFactor:1.05,leafStartSize:0,leafChanceStart:0,leafChanceEnd:0,leafMinSize:0,leafMaxSize:0,leafRange:0,leafAlternateChance:0})},{name:"upside-down",generate:()=>({startPos:{x:.5,y:0},startDir:{x:0,y:1},sizeStart:16,sizeEnd:1,sizeDecreaseSpeed:.025,sizeJitter:.08,rotateAmount:.04,moveJitter:.3,upDir:{x:0,y:1},skyAttractionStart:.01,skyAttractionEnd:.05,splitStartSize:13,splitChanceStart:.01,splitChanceEnd:.05,splitCooldownStart:60,splitCooldownEnd:10,splitChildMinAngle:Math.PI/4,splitChildMaxAngle:Math.PI/3,splitParentMinAngle:0,splitParentMaxAngle:Math.PI/4,splitMinSizeFactor:.5,splitMaxSizeFactor:1,leafStartSize:10,leafChanceStart:0,leafChanceEnd:.25,leafMinSize:2,leafMaxSize:8,leafRange:40,leafAlternateChance:.1})},{name:"weeping",generate:()=>({startPos:{x:.5,y:1},startDir:{x:0,y:-1},sizeStart:16,sizeEnd:1,sizeDecreaseSpeed:.025,sizeJitter:.08,rotateAmount:.02,moveJitter:.3,upDir:{x:0,y:-1},skyAttractionStart:.02,skyAttractionEnd:-.06,splitStartSize:10,splitChanceStart:.04,splitChanceEnd:.5,splitCooldownStart:40,splitCooldownEnd:10,splitChildMinAngle:Math.PI/4,splitChildMaxAngle:Math.PI/3,splitParentMinAngle:0,splitParentMaxAngle:Math.PI/4,splitMinSizeFactor:.55,splitMaxSizeFactor:1,leafStartSize:10,leafChanceStart:0,leafChanceEnd:.25,leafMinSize:2,leafMaxSize:6,leafRange:30,leafAlternateChance:.1})},{name:"square",generate:()=>({startPos:{x:.5,y:1},startDir:{x:0,y:-1},sizeStart:18,sizeEnd:1,sizeDecreaseSpeed:.025,sizeJitter:0,rotateAmount:0,moveJitter:0,upDir:{x:0,y:-1},skyAttractionStart:0,skyAttractionEnd:0,splitStartSize:11,splitChanceStart:.025,splitChanceEnd:.05,splitCooldownStart:80,splitCooldownEnd:10,splitChildMinAngle:Math.PI/2,splitChildMaxAngle:Math.PI/2,splitParentMinAngle:Math.PI/2,splitParentMaxAngle:Math.PI/2,splitMinSizeFactor:1,splitMaxSizeFactor:1,leafStartSize:0,leafChanceStart:0,leafChanceEnd:0,leafMinSize:0,leafMaxSize:0,leafRange:0,leafAlternateChance:0})},{name:"hex",generate:()=>({startPos:{x:.5,y:1},startDir:{x:0,y:-1},sizeStart:18,sizeEnd:1,sizeDecreaseSpeed:.025,sizeJitter:0,rotateAmount:0,moveJitter:0,upDir:{x:0,y:-1},skyAttractionStart:0,skyAttractionEnd:0,splitStartSize:14,splitChanceStart:.0125,splitChanceEnd:1,splitCooldownStart:50,splitCooldownEnd:1,splitChildMinAngle:0,splitChildMaxAngle:0,splitParentMinAngle:Math.PI/3,splitParentMaxAngle:Math.PI/3,splitMinSizeFactor:0,splitMaxSizeFactor:0,leafStartSize:1.026,leafChanceStart:1,leafChanceEnd:1,leafMinSize:8,leafMaxSize:10,leafRange:0,leafAlternateChance:.1})},{name:"fractal",generate:()=>({startPos:{x:.5,y:1},startDir:{x:0,y:-1},sizeStart:18,sizeEnd:1,sizeDecreaseSpeed:.025,sizeJitter:0,rotateAmount:0,moveJitter:0,upDir:{x:0,y:-1},skyAttractionStart:0,skyAttractionEnd:0,splitStartSize:14,splitChanceStart:.1,splitChanceEnd:.5,splitCooldownStart:120,splitCooldownEnd:16,splitChildMinAngle:Math.PI/5,splitChildMaxAngle:Math.PI/5,splitParentMinAngle:Math.PI/5,splitParentMaxAngle:Math.PI/5,splitMinSizeFactor:.9,splitMaxSizeFactor:1,leafStartSize:0,leafChanceStart:0,leafChanceEnd:0,leafMinSize:0,leafMaxSize:0,leafRange:0,leafAlternateChance:0})},{name:"feather",generate:()=>({startPos:{x:.5,y:1},startDir:{x:0,y:-1},sizeStart:16,sizeEnd:1,sizeDecreaseSpeed:.025,sizeJitter:0,rotateAmount:.01,moveJitter:0,upDir:{x:0,y:-1},skyAttractionStart:0,skyAttractionEnd:.1,splitStartSize:14,splitChanceStart:1,splitChanceEnd:1,splitCooldownStart:3,splitCooldownEnd:0,splitChildMinAngle:1.57,splitChildMaxAngle:1.57,splitParentMinAngle:0,splitParentMaxAngle:0,splitMinSizeFactor:.25,splitMaxSizeFactor:.25,leafStartSize:0,leafChanceStart:0,leafChanceEnd:0,leafMinSize:0,leafMaxSize:0,leafRange:0,leafAlternateChance:0})},{name:"minecraft",generate:()=>({startPos:{x:.5,y:1},startDir:{x:0,y:-1},sizeStart:16,sizeEnd:1,sizeDecreaseSpeed:.023,sizeJitter:.1,rotateAmount:0,moveJitter:.3,upDir:{x:0,y:-1},skyAttractionStart:0,skyAttractionEnd:0,splitStartSize:9.9,splitChanceStart:.405,splitChanceEnd:.425,splitCooldownStart:94,splitCooldownEnd:0,splitChildMinAngle:1.5707963267948966,splitChildMaxAngle:1.5704,splitParentMinAngle:1.5704,splitParentMaxAngle:1.5707963267948966,splitMinSizeFactor:.15,splitMaxSizeFactor:.75,leafStartSize:0,leafChanceStart:0,leafChanceEnd:0,leafMinSize:0,leafMaxSize:0,leafRange:0,leafAlternateChance:0})},{name:"insectoid",generate:()=>({startPos:{x:.5,y:1},startDir:{x:0,y:-1},sizeStart:16,sizeEnd:1,sizeDecreaseSpeed:.022,sizeJitter:.01,rotateAmount:.01,moveJitter:.31,upDir:{x:0,y:-1},skyAttractionStart:.12,skyAttractionEnd:0,splitStartSize:14,splitChanceStart:1,splitChanceEnd:1,splitCooldownStart:3,splitCooldownEnd:0,splitChildMinAngle:1.57,splitChildMaxAngle:1.963,splitParentMinAngle:0,splitParentMaxAngle:.3926,splitMinSizeFactor:.25,splitMaxSizeFactor:.25,leafStartSize:3.2,leafChanceStart:.09,leafChanceEnd:.14,leafMinSize:1,leafMaxSize:3,leafRange:4,leafAlternateChance:.05})}],D=Math.PI/16,Mt=[{name:"sizeStart",displayName:"Starting size",description:"Starting size of tree trunk (pixels)",min:1,max:30,step:.5},{name:"sizeEnd",displayName:"Ending size",description:"Size at which the branch stops growing",min:.5,max:30,step:.5},{name:"sizeDecreaseSpeed",displayName:"Size decrease",description:"Speed at which branches get smaller (pixels/frame)",min:.01,max:.1,step:.001},{name:"sizeJitter",displayName:"Size jitter",description:"Amount of random change to branch size each frame (pixels)",min:0,max:.5,step:.01},{name:"rotateAmount",displayName:"Rotation amount",description:"Amount of random branch rotation each frame",min:0,max:.5,step:.001},{name:"moveJitter",displayName:"Move jitter",description:"Amount of random offset to branch each frame (pixels)",min:0,max:2,step:.01},{name:"skyAttractionStart",displayName:"Sky attraction start",description:"Starting (max size) branch attraction towards the sky",min:-.2,max:.2,step:.01},{name:"skyAttractionEnd",displayName:"Sky attraction end",description:"Ending (branch end) branch attraction towards the sky",min:-.2,max:.2,step:.01},{name:"splitStartSize",displayName:"Split start size",description:"Branch size at which branches start splitting (pixels)",min:0,max:30,step:.1},{name:"splitChanceStart",displayName:"Split chance start",description:"Starting split probability each frame",min:0,max:1,step:.001},{name:"splitChanceEnd",displayName:"Split chance end",description:"Ending (branch end) split probability each frame",min:0,max:1,step:.001},{name:"splitCooldownStart",displayName:"Split cooldown start",description:"Starting cooldown between two splits (frames)",min:0,max:120,step:1},{name:"splitCooldownEnd",displayName:"Split cooldown end",description:"Ending (branch end) cooldown between two splits (frames)",min:0,max:120,step:1},{name:"splitChildMinAngle",displayName:"Child min angle",description:"Minimum angle for split child branches (radians)",min:0,max:Math.PI,step:D},{name:"splitChildMaxAngle",displayName:"Child max angle",description:"Maximum angle for split child branches (radians)",min:0,max:Math.PI,step:D},{name:"splitParentMinAngle",displayName:"Parent min angle",description:"Minimum angle for split parent branches (radians)",min:0,max:Math.PI,step:D},{name:"splitParentMaxAngle",displayName:"Parent max angle",description:"Maximum angle for split parent branches (radians)",min:0,max:Math.PI,step:D},{name:"splitMinSizeFactor",displayName:"Split min size",description:"Minimum factor of parent branch for child size",min:0,max:1,step:.05},{name:"splitMaxSizeFactor",displayName:"Split max size",description:"Maximum factor of parent branch for child size",min:0,max:1.1,step:.05},{name:"leafStartSize",displayName:"Leaf start size",description:"Size at which branches start growing leaves",min:0,max:30,step:.1},{name:"leafChanceStart",displayName:"Leaf chance start",description:"Starting probability to grow a leaf each frame",min:0,max:1,step:.01},{name:"leafChanceEnd",displayName:"Leaf chance end",description:"Ending (branch end) probability to grow a leaf each frame",min:0,max:1,step:.01},{name:"leafMinSize",displayName:"Leaf min size",description:"Minimum radius of a leaf (pixels)",min:0,max:32,step:1},{name:"leafMaxSize",displayName:"Leaf max size",description:"Maximum radius of a leaf (pixels)",min:0,max:32,step:1},{name:"leafRange",displayName:"Leaf range",description:"Maximum distance a leaf can appear from a branch",min:0,max:64,step:1},{name:"leafAlternateChance",displayName:"Leaf alt chance",description:"Probability to draw a different colored leaf",min:0,max:1,step:.05}];var Ct=y('<div class="fixed top-0 z-10 flex h-full w-full flex-col justify-between bg-bg-alt bg-opacity-50 px-3 py-1 sm:right-0 sm:max-w-xl sm:px-4 sm:py-2"><div class="flex w-full flex-row"><button type=button class="text-btn mr-auto w-fit">[X] Close</button><label for=preset class=pr-2>Preset</label><select id=preset class="w-48 rounded-sm px-2 outline-1 outline-accent-2"><option disabled value=custom>custom</option><!$><!/></select></div><div class="mt-2 h-px w-full bg-accent-1"></div><div class="flex-1 overflow-auto"><div class="slider-grid pt-2"></div></div><div class="flex flex-row gap-3"><button type=button class=text-btn>[Save image]</button><button type=button class=text-btn>[Export preset file]</button><div class="flex flex-row"><label for=import class=text-btn>[Import preset file]</label><input id=import type=file accept=.tree class=hidden>'),yt=y("<option>"),At=y("<label>"),ut=y("<input type=range class=slider>"),Pt=y('<p class="slider-value ml-1">');const Et=e=>{const[t,a]=at("default"),n=i=>{a(i);const d=K.find(p=>p.name===i);d&&(e.setConfig(d.generate()),e.onChange())},s=()=>{const i=JSON.stringify(e.config);xt("config.tree",i)},c=i=>{if(!i.files)return;const d=new FileReader;d.onload=()=>{const p=d.result;a("custom"),e.setConfig(JSON.parse(p)),e.onChange()},d.readAsText(i.files[0])};return(()=>{var i=M(Ct),d=i.firstChild,p=d.firstChild,N=p.nextSibling,f=N.nextSibling,A=f.firstChild,R=A.nextSibling,[v,L]=J(R.nextSibling),O=d.nextSibling,u=O.nextSibling,j=u.firstChild,T=u.nextSibling,I=T.firstChild,k=I.nextSibling,ht=k.nextSibling,St=ht.firstChild,ft=St.nextSibling;return p.$$click=()=>{e.onClose()},f.addEventListener("change",r=>{n(r.target.value)}),S(f,C(W,{each:K,children:r=>(()=>{var l=M(yt);return S(l,()=>r.name),x(()=>B(l,"value",r.name)),l})()}),v,L),S(j,C(W,{each:Mt,children:r=>[(()=>{var l=M(At);return S(l,()=>r.displayName),x(o=>{var P=r.name,E=r.description;return P!==o.e&&g(l,"for",o.e=P),E!==o.t&&g(l,"title",o.t=E),o},{e:void 0,t:void 0}),l})(),(()=>{var l=M(ut);return l.addEventListener("change",o=>{a("custom"),e.setConfig(r.name,+o.target.value),e.onChange()}),x(o=>{var P=r.name,E=r.min,U=r.max,X=r.step;return P!==o.e&&g(l,"id",o.e=P),E!==o.t&&g(l,"min",o.t=E),U!==o.a&&g(l,"max",o.a=U),X!==o.o&&g(l,"step",o.o=X),o},{e:void 0,t:void 0,a:void 0,o:void 0}),x(()=>B(l,"value",+e.config[r.name])),l})(),(()=>{var l=M(Pt);return S(l,()=>(+e.config[r.name]).toFixed(2)),x(()=>g(l,"title",r.description)),l})()]})),I.$$click=()=>{e.onOpenImage()},k.$$click=s,ft.addEventListener("change",r=>{c(r.target)}),x(()=>B(f,"value",t())),it(),i})()};et(["click"]);const $=e=>(Math.random()-.5)*2*e,w=(e,t)=>e>t?e:e+Math.random()*(t-e),wt=()=>Math.random()*Math.PI*2,b=(e,t,a,n,s)=>(e-t)/(a-t)*(s-n)+n;class z{x;y;constructor({x:t,y:a}){this.x=t,this.y=a}add(t){this.x+=t.x,this.y+=t.y}rotate(t){const a=Math.cos(-t),n=Math.sin(-t),s=a*this.x-n*this.y,c=n*this.x+a*this.y;this.x=s,this.y=c}angle(){return Math.atan2(-this.y,this.x)}angleTo(t){const a=t.angle()-this.angle();return bt(a+Math.PI,2*Math.PI)-Math.PI}normalize(){const t=Math.sqrt((this.x-this.y)**2);this.x/=t,this.y/=t}dot(t){return this.x*t.x+this.y*t.y}clone(){return new z({x:this.x,y:this.y})}}const bt=(e,t)=>(e%t+t)%t,q=getComputedStyle(document.body),vt=`rgb(${q.getPropertyValue("--color-fg")})`,lt=.75,It=`rgb(${q.getPropertyValue("--color-accent-1")} / ${lt})`,kt=`rgb(${q.getPropertyValue("--color-accent-2")} / ${lt})`;class G{pos;dir;size;cooldown;config;done;constructor(t,a,n,s,c){this.pos=t,this.dir=a,this.size=n,this.config=s,this.done=!1,this.cooldown=c}tick(t){if(this.done)return;this.cooldown-=1,this.size-=this.config.sizeDecreaseSpeed+$(this.config.sizeJitter),this.pos.add(this.dir);const a=new z({x:$(this.config.moveJitter),y:$(this.config.moveJitter)});if(this.pos.add(a),this.dir.rotate($(this.config.rotateAmount)),this.applySkyAttraction(),this.shouldSplit()){const n=b(this.size,this.config.splitStartSize,this.config.sizeEnd,this.config.splitCooldownStart,this.config.splitCooldownEnd);this.cooldown=n;const s=Math.random()<.5?-1:1,c=this.createChild(s);c.size>this.config.sizeEnd&&t.push(c);const i=w(this.config.splitParentMinAngle,this.config.splitParentMaxAngle);this.dir.rotate(-s*i)}this.size<this.config.sizeEnd&&(this.done=!0)}applySkyAttraction(){const t=b(this.size,this.config.sizeStart,this.config.sizeEnd,this.config.skyAttractionStart,this.config.skyAttractionEnd),a=new z(this.config.upDir),c=(-this.dir.dot(a)/2+.5)*t,i=Math.sign(this.dir.angleTo(a));this.dir.rotate(i*c)}shouldSplit(){const t=b(this.size,this.config.splitStartSize,this.config.sizeEnd,this.config.splitChanceStart,this.config.splitChanceEnd);return this.cooldown<=0&&this.size<=this.config.splitStartSize&&Math.random()<t}createChild(t){const a=w(this.config.splitChildMinAngle,this.config.splitChildMaxAngle),n=this.dir.clone();n.rotate(t*a);const s=w(this.config.splitMinSizeFactor,this.config.splitMaxSizeFactor),c=this.size*s,i=b(c,this.config.splitStartSize,this.config.sizeEnd,this.config.splitCooldownStart,this.config.splitCooldownEnd);return new G(this.pos.clone(),n,c,this.config,i)}render(t){t.fillStyle=vt,t.beginPath(),t.arc(this.pos.x,this.pos.y,this.size,0,Math.PI*2),t.fill(),this.shouldDrawLeaf()&&this.drawLeaf(t)}shouldDrawLeaf(){const t=b(this.size,this.config.leafStartSize,this.config.sizeEnd,this.config.leafChanceStart,this.config.leafChanceEnd);return this.size<=this.config.leafStartSize&&Math.random()<t}drawLeaf(t){const a=w(this.config.leafMinSize,this.config.leafMaxSize),n=w(0,this.config.leafRange),s=new z({x:n,y:0});s.rotate(wt()),s.add(this.pos),t.fillStyle=Math.random()<this.config.leafAlternateChance?kt:It,t.beginPath(),t.arc(s.x,s.y,a,0,Math.PI*2),t.fill()}}let m,_=!0,rt=0,H=!1;const Q=(e,t,a)=>{window.cancelAnimationFrame(rt),t.clearRect(0,0,e.width,e.height),_=!1,m=[new G(new z({x:a.startPos.x*nt,y:a.startPos.y*st}),new z(a.startDir),a.sizeStart,a,0)],H?ot(t):ct(t)},Z=e=>{H=e},ot=e=>{for(;!_;)dt(),pt(e)},ct=e=>{_||(dt(),pt(e),H?ot(e):rt=window.requestAnimationFrame(()=>{ct(e)}))},dt=()=>{m.forEach(e=>{e.tick(m)}),m=m.filter(e=>!e.done),m.length===0&&(_=!0)},pt=e=>{m.forEach(t=>{t.render(e)})};var Dt=y('<div class="flex flex-col items-center justify-center"><!$><!/><canvas id=canvas></canvas><div class="card flex flex-row items-center gap-2 p-2"><!$><!/><!$><!/><div class="mx-2 flex h-full items-baseline"><input type=checkbox id=instant><label for=instant class=ps-2>Instant');let h,F;const tt=()=>{if(!h)return;const e=h.toDataURL("image/png");window.open(e)},_t=()=>{const[e,t]=zt(V()),[a,n]=at(!1);gt(()=>{h=document.getElementById("canvas"),F=h.getContext("2d"),h.width=nt,h.height=st,Z(!1),Q(h,F,V())});const s=()=>{!h||!F||Q(h,F,e)},c=()=>{n(i=>!i)};return(()=>{var i=M(Dt),d=i.firstChild,[p,N]=J(d.nextSibling),f=p.nextSibling,A=f.nextSibling,R=A.firstChild,[v,L]=J(R.nextSibling),O=v.nextSibling,[u,j]=J(O.nextSibling),T=u.nextSibling,I=T.firstChild;return S(i,C(mt,{get when(){return a()},get children(){return C(Et,{config:e,setConfig:t,onClose:()=>{n(!1)},onOpenImage:tt,onChange:s})}}),p,N),f.$$dblclick=tt,S(A,C(Y,{onClick:c,children:"Options"}),v,L),S(A,C(Y,{onClick:s,children:"Generate"}),u,j),I.addEventListener("change",k=>{Z(k.target.checked)}),it(),i})()};et(["dblclick"]);export{_t as default};
